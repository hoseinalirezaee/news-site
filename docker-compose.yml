version: "3.7"

services:
  postgres:
    image: postgres
    ports:
      - 5432:5432
    expose:
      - 5432
    environment:
      POSTGRES_USER: username
      POSTGRES_PASSWORD: password
      POSTGRES_DB: news

  redis:
    image: redis

  web:
    build: ./News
    volumes:
      - type: volume
        source: statics
        target: /app/statics
    depends_on:
      - postgres
      - redis
    environment:
      DJANGO_SUPERUSER_USERNAME: username
      DJANGO_SUPERUSER_PASSWORD: password
      DATABASE_USER: username
      DATABASE_PASS: password
      DATABASE_HOST: postgres
      DATABASE_PORT: 5432
      REDIS_URL: redis://redis:6379

  nginx:
    build: ./Nginx
    volumes:
      - type: volume
        source: statics
        target: /var/statics
    ports:
      - '127.0.0.1:8000:80'
    depends_on:
      - web

  crawler:
    build: ./crawler
    environment:
      API_URL: http://web:8000/api/interface/posts/
      API_USER: username
      API_PASS: password
    depends_on:
      - web

volumes:
  statics: